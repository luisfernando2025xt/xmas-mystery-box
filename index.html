<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>XMAS Mystery Box â€” Unique Santa Letter</title>
<style>
  :root { --bg:#000; --fg:#fff; --gold:#ffd86b; }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:"Courier New",monospace;overflow-y:auto;}
  .wrap{max-width:820px;margin:36px auto;padding:20px;box-sizing:border-box;}
  h1{margin:0 0 8px 0;text-align:center;}
  .center{display:flex;justify-content:center;gap:10px;align-items:center;}
  button{background:none;border:2px solid var(--fg);color:var(--fg);padding:10px 18px;cursor:pointer;border-radius:8px}
  button:hover{background:var(--fg);color:#000}
  #ascii{white-space:pre;font-size:15px;line-height:17px;display:none;margin-top:18px;text-align:center}
  #introMsg{margin-top:18px;font-size:16px;min-height:48px;opacity:0;transition:opacity .35s}
  .hidden{display:none}
  #claimBox, #nameBox, #letterBox, #finalSanta{opacity:0;transition:opacity .35s;margin-top:18px}
  .show{display:block;opacity:1}
  input[nameField]{padding:8px 10px;font-size:16px;background:#111;border:1px solid #444;color:var(--fg);text-align:center;border-radius:6px}
  #maskedInput{padding:8px 12px;font-size:16px;background:#111;border:1px solid #444;color:var(--fg);text-align:center;border-radius:6px;letter-spacing:3px}
  #letterContent{white-space:pre-line;text-align:left;font-size:16px;line-height:22px;padding:14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.01);max-width:100%}
  .tiny{font-size:13px;color:rgba(255,255,255,0.6);margin-top:6px;text-align:center}
  .glow { text-shadow:0 0 12px rgba(255,216,107,0.5) }
  .snow{position:fixed;top:-10px;color:var(--fg);pointer-events:none;opacity:.8;font-size:12px;z-index:1}
  /* small animations */
  @keyframes shake{0%{transform:translate(0)}25%{transform:translate(4px,-4px)}50%{transform:translate(-4px,4px)}75%{transform:translate(4px,4px)}100%{transform:translate(0)}}
  .shake{animation:shake .36s ease-in-out}
  /* final present highlight */
  .present { color: var(--gold); font-weight:700; text-shadow:0 0 8px rgba(255,216,107,0.7); }
</style>
</head>
<body>
  <div class="wrap">
    <h1>XMAS Mystery Box</h1>
    <div class="center">
      <button id="openBtn">Open Mystery Box</button>
      <div class="tiny">One surprise per open Â· Personalized letter</div>
    </div>

    <div id="ascii" aria-hidden="true">
`          * *.  
        *     *  
       *  o o  *  
      *    âˆ†    *  
       *  ---  *  
        *     *  
          * *       `
    </div>

    <div id="introMsg" role="status"></div>

    <!-- claim -->
    <div id="claimBox" class="hidden">
      <p style="margin:8px 0 4px 0;text-align:center">Do you want to claim your Santa's letter?</p>
      <div class="center">
        <button id="yesClaim">Yes â€” claim my letter</button>
      </div>
    </div>

    <!-- masked name -->
    <div id="nameBox" class="hidden">
      <p style="margin:8px 0 6px 0;text-align:center">Type your name (it will stay hidden):</p>
      <div class="center">
        <input id="maskedInput" placeholder="Type here..." autocomplete="off" autocapitalize="words" />
      </div>
      <div class="center" style="margin-top:10px">
        <button id="startLetterBtn">Get My Letter</button>
      </div>
      <div class="tiny">Your name is kept private and only used to craft the final surprise.</div>
    </div>

    <!-- letter area -->
    <div id="letterBox" class="hidden">
      <div id="letterContent"></div>
      <div class="center" style="margin-top:10px">
        <button id="nextSentenceBtn">Next sentence</button>
      </div>
      <div class="tiny">Click "Next sentence" to reveal more â€” the letter is long and worth it.</div>
    </div>

    <!-- final santa -->
    <div id="finalSanta" class="hidden" style="text-align:center;white-space:pre;font-family:Courier,monospace;margin-top:18px"></div>
  </div>

<script>
/* ---------------- DATA: premium intros, traits, blocks, endings, letter fragments ---------------- */
const premiumIntro = [
  "Thereâ€™s a version of you in the future who is begging you not to give up right now.",
  "You werenâ€™t lateâ€¦ life was rearranging the stage so that youâ€™d enter at the perfect second.",
  "Something you lost this year was actually clearing space for something that needs both hands free.",
  "Someone is about to treat you with the kindness you forgot you deserved.",
  "Thereâ€™s a door youâ€™ve been knocking on, but the funny part is that your name is already written inside.",
  "The universe has been unusually quiet about you latelyâ€¦ thatâ€™s always a sign that something big is loading.",
  "Your potential is starting to make the right people curious.",
  "This season of your life wonâ€™t require who youâ€™ve beenâ€¦ it will demand who youâ€™re becoming.",
  "Life is currently connecting dots for youâ€”silently, but with intention.",
  "Not everyone gets a second chance. Youâ€™re about to get three."
];

const traits = [
  "quiet stubbornness that wins in the end",
  "a curiosity that makes strangers listen",
  "an odd kindness you never notice yourself",
  "the habit of finishing things others abandon",
  "a loud thought that hides under a quiet face"
];

const challenges = [
  "small humiliations that taught you paradoxical strength",
  "nights of doubt that were actually strategy sessions",
  "moments of fatigue that secretly built discipline",
  "confusions that aligned your priorities",
  "delays that polished your patience"
];

const optionalBlocks = [
  "There will be a phone call that looks unimportant and becomes a hinge in your story.",
  "A stranger will compliment something you thought was invisible.",
  "You will find the courage to say 'I need help' and it will change everything.",
  "That old idea you laughed at will return wearing better clothes.",
  "An apology you forget to give will arrive in another form â€” accept it."
];

const endings = [
  "Keep opening boxes. They contain small keys to larger doors.",
  "This is the quiet start of something that will one day be obvious.",
  "Youâ€™ll tell this story later with a grin and some disbelief.",
  "The best is quieting itself to prepare a proper entrance for you."
];

/* Build dynamic letter template pieces */
function buildUniqueLetter(name){
  // select random elements
  const t1 = rand(traits);
  const c1 = rand(challenges);
  const block1 = rand(optionalBlocks);
  const ending = rand(endings);

  // base sentences (we keep them many to be long)
  const base = [
    `Ho ho ho! Santa here, quietly bribing the reindeer to read your chapters.`,
    `For weeks I watched small things add up around you, ${name}.`,
    `You have a particular gift: ${t1}.`,
    `That gift appears in odd moments and gets mistaken for habit.`,
    `I saw you carry on despite ${c1}.`,
    `You turned those small injuries into an odd kind of armor.`,
    `${block1}`,
    `There will be a tiny shift this month; it will feel like a lucky accident and a careful plan at once.`,
    `Youâ€™ll notice people nodding in places you thought no one noticed you.`,
    `Something you thought required proof will need only your courage now.`,
    `An offer will show up disguised as a questionâ€”say yes if your heart leans forward.`,
    `Your sense of humor (yes, that one) will become currency in a room you want to be in.`,
    `Protect your time like a souvenir. Use it to practice the small things that matter.`,
    `A stubborn idea you abandoned will return with better friends.`,
    `There will be a day soon when you laugh at what once scared you.`,
    `Do not be shy about taking credit for the small improvements â€” they add up.`,
    `You will meet someone who sees the version of you that was hidden in the dark.`,
    `A plan you shelved will find momentum when you least expect it.`,
    `There is a door waiting; your name is already on the key.`,
    `Keep some of your days intentionally empty â€” space invites surprises.`,
    `Sometimes rest is the most radical thing you can do.`,
    `When you are tempted to play small, remember the last small risk that paid off.`,
    `A tiny victory will arrive disguised as an ordinary morning â€” collect it.`,
    `Share one small story this week; it will reach the person you needed.`,
    `If you forget everything else I said, remember: ${ending}`,
    `I put my hand on the gift I saved for you. It fits your laughter.`
  ];

  // ensure letter is long: mix base with additional generated lines
  const extra = [];
  for(let i=0;i<6;i++){
    extra.push( generateMiniLine(name) );
  }

  // final wrap lines
  const final = [
    `Keep daring. Keep laughing. Keep failing in spectacular ways and learning quickly.`,
    `If you ever feel small, remember small hands move heavy things when they move together.`,
    `I tuck a secret promise into a pocket of the coming months â€” carry it with a soft grin.`,
    `From the North Pole, with melted cocoa and a warm nod â€” Santa.`
  ];

  return base.concat(extra).concat(final);
}

function generateMiniLine(name){
  const tunes = [
    `You will remember this as the year you quietly assembled your courage, ${name}.`,
    `There will be coffee, a note, or a door. Answer with curiosity.`,
    `${name}, the stitches in your patience are about to become a tapestry.`,
    `A small unusual favor you once did will arrive back with interest.`,
    `You are allowed to want big things and to plan them awkwardly.`,
    `Something small that made you smile will become the map to a new habit.`
  ];
  return rand(tunes);
}

/* ----------------- HELPERS ----------------- */
function rand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

/* ----------------- UI REFS & STATE ----------------- */
const openBtn = document.getElementById('openBtn');
const ascii = document.getElementById('ascii');
const introMsg = document.getElementById('introMsg');
const claimBox = document.getElementById('claimBox');
const yesClaim = document.getElementById('yesClaim');
const nameBox = document.getElementById('nameBox');
const maskedInput = document.getElementById('maskedInput');
const startLetterBtn = document.getElementById('startLetterBtn');
const letterBox = document.getElementById('letterBox');
const letterContent = document.getElementById('letterContent');
const nextSentenceBtn = document.getElementById('nextSentenceBtn');
const finalSanta = document.getElementById('finalSanta');

let realName = "";               // stores actual name
let currentLetter = [];          // array of sentences for this user
let currentIndex = 0;

/* ---------- snow helper (light) ---------- */
function createSnow(count=18){
  for(let i=0;i<count;i++){
    const s = document.createElement('div');
    s.className = 'snow';
    s.style.left = (Math.random()*100) + 'vw';
    s.style.fontSize = (8 + Math.random()*18) + 'px';
    s.textContent = Math.random() > 0.82 ? 'â†' : '*';
    document.body.appendChild(s);
    const dur = 3 + Math.random()*5;
    s.style.animationDuration = dur + 's';
    setTimeout(()=> s.remove(), (dur+0.2)*1000);
  }
}

/* ---------- Open Flow ---------- */
openBtn.addEventListener('click', ()=> {
  openBtn.classList.add('shake');
  setTimeout(()=> openBtn.classList.remove('shake'),380);

  ascii.style.display='block';
  ascii.style.opacity=1;

  // pick one premium intro
  const intro = rand(premiumIntro);
  typeWriter(intro, introMsg, 30, ()=> {
    // show claim box
    claimBox.classList.remove('hidden');
    claimBox.classList.add('show');
    createSnow(12);
  });
});

/* tiny typewriter for intro */
function typeWriter(text, el, speed=30, cb=null){
  el.textContent = "";
  el.style.display = 'block';
  let i=0;
  const iv = setInterval(()=> {
    el.textContent += text.charAt(i);
    i++;
    if(i>=text.length){ clearInterval(iv); if(cb) cb(); }
  }, speed);
  el.style.opacity = 1;
}

/* ---------- Claim & Name (masked) ---------- */
yesClaim.addEventListener('click', ()=> {
  claimBox.classList.remove('show');
  claimBox.classList.add('hidden');
  nameBox.classList.remove('hidden');
  nameBox.classList.add('show');
  maskedInput.focus();
});

/* Masked input handling:
   We capture keystrokes to maintain realName while showing stars.
   Handle printable characters, backspace/delete, and paste.
*/
maskedInput.addEventListener('keydown', (e)=>{
  const key = e.key;
  if(key === 'Backspace'){
    e.preventDefault();
    realName = realName.slice(0, -1);
    maskedInput.value = "*".repeat(realName.length);
    return;
  }
  if(key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey){
    // printable char
    e.preventDefault();
    realName += key;
    maskedInput.value = "*".repeat(realName.length);
    return;
  }
  // allow navigation keys etc.
});

/* paste support: grab clipboard text */
maskedInput.addEventListener('paste', (e)=>{
  e.preventDefault();
  const text = (e.clipboardData || window.clipboardData).getData('text') || '';
  // sanitize small: trim and limit 24 chars
  const clean = text.trim().slice(0,24);
  realName += clean;
  maskedInput.value = "*".repeat(realName.length);
});

/* Start letter after name set */
startLetterBtn.addEventListener('click', ()=> {
  if(!realName || realName.trim().length === 0){
    alert('Type your name (it stays hidden).');
    maskedInput.focus();
    return;
  }
  // build unique long letter for this user
  currentLetter = buildUniqueLetter(realName);
  currentIndex = 0;

  // hide name box, show letter box
  nameBox.classList.remove('show');
  nameBox.classList.add('hidden');
  letterBox.classList.remove('hidden');
  letterBox.classList.add('show');

  letterContent.innerHTML = "";
  nextSentenceBtn.style.display = 'inline-block';

  // reveal first sentence immediately
  revealNext();
});

/* Reveal one sentence at a time with typing effect */
function revealNext(){
  if(currentIndex >= currentLetter.length){
    // finished: show final Santa
    nextSentenceBtn.style.display = 'none';
    setTimeout(()=> showFinalSanta(), 300);
    return;
  }
  const sentence = currentLetter[currentIndex];
  typeSentence(sentence, letterContent, 22, ()=> {
    // auto-scroll to bottom after each sentence
    setTimeout(()=> window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }), 120);
  });
  currentIndex++;
}

/* type out a sentence into target element by appending a new paragraph */
function typeSentence(text, target, speed=24, cb=null){
  const p = document.createElement('div');
  p.style.marginBottom = '10px';
  p.style.opacity = '1';
  target.appendChild(p);
  let i=0;
  const iv = setInterval(()=> {
    p.textContent += text.charAt(i);
    i++;
    if(i>=text.length){ clearInterval(iv); if(cb) cb(); }
  }, speed);
}

/* next sentence button */
nextSentenceBtn.addEventListener('click', ()=> {
  // small button feedback
  nextSentenceBtn.classList.add('shake');
  setTimeout(()=> nextSentenceBtn.classList.remove('shake'),300);
  revealNext();
});

/* final santa ascii with present showing real name (centered/truncated elegantly) */
function showFinalSanta(){
  const nameToShow = (realName && realName.length>0) ? realName.trim() : 'Friend';
  const display = centerPad(nameToShow, 12);
  const santa = `
       â €â €â €â €â €â €â €â¢€â£€â£€â£€â£€â¡€â €â €â €â €â €â €
       â €â €â €â €â €â €â¢€â£¾â£¿â£¿â£¿â£¿â£¿â£·â¡€â €â €â €â €
       â €â €â €â €â €â €â£¼â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡„â €â €â €
       â €â €â €â €â €â¢°â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡€â €â €
       â €â €â €â €â €â ¸â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡‡â €â €
       â €â €â €â €â €â €â ˆâ ›â ¿â£¿â£¿â£¿â£¿â£¿â ¿â ›â â €â €
       â €â €â €â €â£€â£€â£¤â£¶â£¶â£¶â£¶â£¶â£¦â£¤â£€â£€â €â €â €
       â €â €â €â¢°â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡†â €â €
       â €â €â €â¢¸â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡‡â €â €
       â €â €â €â €â ‰â ›â ›â ›â ›â ›â ›â ›â ›â ‰â ‰â ‰â €â €â €
         Santa saved a present just for you:
         
             [ ${display} ]
             
         (Open it with a smile) ðŸŽ
  `;
  finalSanta.textContent = santa;
  finalSanta.classList.remove('hidden');
  finalSanta.classList.add('show');
  finalSanta.classList.add('glow');
  // add present line highlight by replacing the bracketed name with gold-colored element
  // note: we keep text content for monospace ASCII but we add an extra small line below with colored name
  setTimeout(()=> {
    const el = document.createElement('div');
    el.innerHTML = `<div style="margin-top:8px;font-size:18px;"><span class="present">${escapeHtml(nameToShow)}</span></div>`;
    finalSanta.appendChild(el);
    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
  }, 120);
}

/* center/pad helper */
function centerPad(s, maxLen){
  if(s.length > maxLen) return s.slice(0,maxLen-1) + 'â€¦';
  const pad = maxLen - s.length;
  const left = Math.floor(pad/2);
  const right = pad - left;
  return ' '.repeat(left) + s + ' '.repeat(right);
}

/* sanitize for HTML insertion */
function escapeHtml(text){
  return String(text).replace(/[&<>"']/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
}

/* small initial snow and UX niceties */
createSnow(10);
</script>
</body>
</html>
